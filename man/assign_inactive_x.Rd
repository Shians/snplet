% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/assign_inactive_x.R
\name{assign_inactive_x}
\alias{assign_inactive_x}
\title{Assign Inactive X Chromosome}
\usage{
assign_inactive_x(
  x,
  snp_quantile = 0.9,
  cell_quantile = 0.8,
  max_snps = 200,
  max_cells = 1000,
  min_total_count = 10,
  het_p_value = 0.05
)
}
\arguments{
\item{x}{A SNPData object}

\item{snp_quantile}{Quantile threshold for SNP coverage filtering (default 0.9).
Only chrX SNPs with coverage >= this quantile are used for clustering.}

\item{cell_quantile}{Quantile threshold for cell library size filtering (default 0.8).
Only cells with library size >= this quantile are used for training the model.}

\item{max_snps}{Maximum number of SNPs to use for clustering (default 200).
If more SNPs pass the quantile filter, the top max_snps by coverage are selected.}

\item{max_cells}{Maximum number of cells to use for training (default 1000).
If more cells pass the quantile filter, max_cells are randomly sampled.}

\item{min_total_count}{Minimum total read depth per donor for heterozygosity testing (default 10).
Passed to donor_het_status_df for identifying heterozygous SNPs.}

\item{het_p_value}{P-value threshold for heterozygosity testing (default 0.05).
Passed to donor_het_status_df for identifying heterozygous SNPs.}
}
\value{
A SNPData object with added barcode metadata columns:
  \itemize{
    \item inactive_x: Predicted inactive X chromosome ("X1" or "X2")
    \item inactive_x_prob: Probability of the assignment (max of the two class probabilities)
  }
}
\description{
Infers which X chromosome is inactive in female cells based on allele-specific
expression patterns. Uses hierarchical clustering on high-coverage chrX SNPs
to identify two groups of cells with correlated expression patterns, then
fits a Gaussian Mixture Model to classify all cells.
}
\details{
The function follows these steps:
\enumerate{
  \item Filter to chrX SNPs with high coverage (>= snp_quantile)
  \item Filter to heterozygous SNPs using donor_het_status_df
  \item Subsample to at most max_snps SNPs (highest coverage)
  \item Filter to cells with high library size (>= cell_quantile)
  \item Subsample to at most max_cells cells (random sampling)
  \item Convert to expression matrix using sign(REF-ALT) * log1p(|REF-ALT|)
  \item Cluster cells using hierarchical clustering (Ward's method) on correlation distance
  \item Cut dendrogram into 2 clusters
  \item Calculate cluster assignment scores for all cells
  \item Fit Gaussian Mixture Model on training scores
  \item Predict inactive X for all cells using the GMM
}

Note: This function requires donor information in barcode metadata, as it filters
to heterozygous SNPs based on donor-level genotypes. Homozygous SNPs cannot be
used for X inactivation analysis since they lack allele-specific signal.
}
\examples{
\dontrun{
# Assign inactive X chromosome
snpdata <- assign_inactive_x(snpdata)

# View results
barcode_info <- get_barcode_info(snpdata)
table(barcode_info$inactive_x)

# Use more stringent filtering
snpdata <- assign_inactive_x(
    snpdata,
    snp_quantile = 0.95,
    cell_quantile = 0.9
)

# Use fewer SNPs and cells for faster computation
snpdata <- assign_inactive_x(
    snpdata,
    max_snps = 100,
    max_cells = 500
)

# Adjust heterozygosity testing parameters
snpdata <- assign_inactive_x(
    snpdata,
    min_total_count = 20,
    het_p_value = 0.01
)
}

}
