% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/assign_inactive_x.R
\name{assign_inactive_x}
\alias{assign_inactive_x}
\title{Assign Inactive X Chromosome}
\usage{
assign_inactive_x(
  x,
  min_cell_prop = 0.2,
  cell_quantile = 0.8,
  max_snps = 200,
  max_cells = 1000,
  min_total_count = 10,
  het_p_value = 0.05,
  level = c("barcode", "clonotype")
)
}
\arguments{
\item{x}{A SNPData object with donor information in barcode metadata}

\item{min_cell_prop}{Minimum proportion of cells with non-zero counts for a SNP
to be included in clustering (default 0.2). After filtering cells by cell_quantile,
only SNPs with non-zero counts in at least this proportion of remaining cells are used.
Applied per donor.}

\item{cell_quantile}{Quantile threshold for cell library size filtering (default 0.8).
Only cells with library size >= this quantile are used for training the model.
Applied per donor.}

\item{max_snps}{Maximum number of SNPs to use for clustering (default 200).
If more SNPs pass the quantile filter, the top max_snps by coverage are selected.
Applied per donor.}

\item{max_cells}{Maximum number of cells (or clonotypes if level = "clonotype")
to use for training (default 1000). If more pass the quantile filter, the top
max_cells by library size are selected. Applied per donor.}

\item{min_total_count}{Minimum total read depth per donor for heterozygosity testing (default 10).
Passed to donor_het_status_df for identifying heterozygous SNPs.}

\item{het_p_value}{P-value threshold for heterozygosity testing (default 0.05).
Passed to donor_het_status_df for identifying heterozygous SNPs.}

\item{level}{Either "barcode" (default) or "clonotype". When "clonotype",
counts are aggregated per clonotype before assignment, and clonotype-level
assignments are then assigned back to individual cells.
Requires a "clonotype" column in barcode metadata.}
}
\value{
A SNPData object with added barcode metadata columns:
  \itemize{
    \item inactive_x: Predicted inactive X chromosome ("X1" or "X2")
    \item inactive_x_prob: Probability of the assignment (max of the two class probabilities)
  }
}
\description{
Infers which X chromosome is inactive in female cells based on allele-specific
expression patterns. X inactivation is determined independently for each donor,
as each female individual has her own pattern of X inactivation. Uses hierarchical
clustering on high-coverage heterozygous chrX SNPs to identify two groups of cells
with correlated expression patterns, then fits a Gaussian Mixture Model to classify
all cells from that donor.
}
\details{
The function first removes doublets and unassigned cells, then processes each valid
donor independently with the following steps:
\enumerate{
  \item Remove cells with donor = "doublet" or "unassigned"
  \item For each valid donor:
  \itemize{
    \item When level = "barcode":
      \itemize{
        \item Filter to cells with high library size (>= cell_quantile)
        \item Select top max_cells cells by library size
      }
    \item When level = "clonotype":
      \itemize{
        \item Filter to clonotypes with high total library size (>= cell_quantile)
        \item Select top max_cells clonotypes by total library size
      }
    \item Identify heterozygous chrX SNPs for this donor using donor_het_status_df
    \item Filter to SNPs with non-zero counts in at least min_cell_prop of the filtered cells
    \item Subsample to at most max_snps SNPs (highest coverage)
    \item Convert to expression matrix using sign(REF-ALT) * log1p(|REF-ALT|)
    \item Cluster using hierarchical clustering (Ward's method) on correlation distance
    \item Cut dendrogram into 2 clusters
    \item Calculate cluster assignment scores
    \item Fit Gaussian Mixture Model on training scores
    \item Predict inactive X using the GMM
    \item When level = "clonotype": Map clonotype predictions back to individual cells
  }
}

Note: This function requires donor information in barcode metadata, as X inactivation
is donor-specific and heterozygous SNPs are identified per donor. Doublets and
unassigned cells are automatically excluded from analysis. Homozygous SNPs cannot
be used for X inactivation analysis since they lack allele-specific signal.
}
\examples{
\dontrun{
# Assign inactive X chromosome (analyzed per donor)
snpdata <- assign_inactive_x(snpdata)

# View results by donor
barcode_info <- get_barcode_info(snpdata)
table(barcode_info$donor, barcode_info$inactive_x)

# Use more stringent filtering
snpdata <- assign_inactive_x(
    snpdata,
    min_cell_prop = 0.3,
    cell_quantile = 0.9
)

# Assign by clonotype instead of individual cells
snpdata <- assign_inactive_x(
    snpdata,
    level = "clonotype"
)

# Use fewer SNPs and cells for faster computation
snpdata <- assign_inactive_x(
    snpdata,
    max_snps = 100,
    max_cells = 500
)

# Adjust heterozygosity testing parameters
snpdata <- assign_inactive_x(
    snpdata,
    min_total_count = 20,
    het_p_value = 0.01
)
}

}
