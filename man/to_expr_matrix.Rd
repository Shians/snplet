% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/to_expr_matrix.R
\name{to_expr_matrix}
\alias{to_expr_matrix}
\alias{to_expr_matrix,SNPData-method}
\title{Convert SNPData to expression-like matrix}
\usage{
to_expr_matrix(x, level = c("barcode", "clonotype", "donor"))

\S4method{to_expr_matrix}{SNPData}(x, level = c("barcode", "clonotype", "donor"))
}
\arguments{
\item{x}{SNPData object}

\item{level}{Aggregation level: "barcode", "clonotype", or "donor"}
}
\value{
Matrix with snp_id as rows and cell/clonotype/donor as columns
}
\description{
Transforms SNP allele counts into an expression-like matrix that captures both
allelic imbalance and sequencing depth. This matrix can be used for downstream
analyses such as dimensionality reduction, clustering, or differential expression.
}
\details{
The expression matrix is calculated using the following formula:

\deqn{E = \frac{REF - ALT}{depth + 1} \times \log(depth + 1)}

Where:
\itemize{
  \item \code{depth = REF + ALT} is the total read depth at each SNP position
  \item \code{(REF - ALT) / (depth + 1)} represents the allelic proportion, ranging
        from -1 (all ALT) to +1 (all REF), with 0 indicating balanced expression
  \item \code{log(depth + 1)} weights the signal by sequencing depth, similar to
        log-normalization in RNA-seq analysis
  \item The pseudocount of 1 prevents division by zero and log(0)
}

This transformation has several useful properties:
\itemize{
  \item SNPs with higher depth contribute more to the signal
  \item Allelic imbalance direction is preserved (positive = REF bias, negative = ALT bias)
  \item Low-depth SNPs are naturally down-weighted
  \item The log transformation stabilizes variance across depth ranges
}
}
